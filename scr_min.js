var memcount_rep_int,singer_lookup={0:"reserved",1:"看谷にぃあ",2:"胡桃澤もも",3:"ももにぃあ",4:"逢魔きらら",5:"きらにぃあ",6:"ももきら",7:"ぷちここ",9:"つきみゆこ",10:"愛白ふりる",12:"小悪熊ちゅい",19:"ゆこもも",21:"ゆこきら"},display_order=[-1,7,6,4,5,3,2,1,-1,14,13,11,12,10,9,8],member_display_order=[7,6,5,3,4,2,1],series_lookup={"マクロス":["マクロス","まくろす"],"ラブライブ":["ラブライブ","らぶらいぶ","LL","ll"],"アイマス":["アイマス","あいます","デレマス","でれます"],"ジブリ":["ジブリ","じぶり"],"物語シリーズ":["物語シリーズ","ものがたりしりーず","ものがたりシリーズ"],"まどマギ":["まどマギ","まどまぎ","まどか"]},entry_idx={song_id:0,video:1,note:2,time:3,type:4},song_idx={name:0,artist:1,reading:2,attr:3,release:4,reference:5},video_idx={id:0,date:1},version="1.5.1a",key_hash=["473c05c1ae8349a187d233a02c514ac73fe08ff4418429806a49f7b2fe4ba0b7a36ba95df1d58b8e84a602258af69194","3f01e53f1bcee58f6fb472b5d2cf8e00ce673b13599791d8d2d4ddcde3defbbb4e0ab7bc704538080d704d87d79d0410"],prevent_menu_popup=!1,current_page="home",key_valid=0,max_display=100,do_display_hidden=!0,do_clear_input=!1,do_random_anyway=!1,hard_filter=7,do_share_web=!1,entry_proc=[],processed_song_name=[""];function init(){$("#input").val("");{const i=new Date("2021-01-01");function e(e){var t=new Date(i);return t.setDate(i.getDate()+e),t.toISOString().slice(0,10)}for(var t in video)video[t][video_idx.date]=e(video[t][video_idx.date]);for(var t in entry)entry[t][entry_idx.note]=note_index[entry[t][entry_idx.note]];note_index=null}for(var t in song)entry_proc[t]=[];for(t=0;t<entry.length;++t)entry[t][entry_idx.type]&hard_filter&&entry_proc[entry[t][0]].push(t);$("#info_version").html(version),$("#info_last-update").html(video[video.length-1][video_idx.date]),auto_display_max=Math.floor(5*Math.pow(window.innerHeight/window.innerWidth,1.41421356237));var s=[];function r(e){switch(e){case 1:case 2:case 4:case 9:case 10:case 12:return[e];case 3:return[1,2];case 5:return[1,4];case 6:return[2,4];case 7:return[1,2,4]}}for(t=1;t<song.length;++t)processed_song_name.push(song[t][song_idx.name].toLowerCase().normalize("NFKC"));for(t=0;t<song.length;++t){for(var n in rep_list[t]=0,entry_proc[t]){if(7==(7&rep_list[t]))break;rep_list[t]|=entry[entry_proc[t][n]][entry_idx.type]}for(var n in rep_list[t]&=-9,s[t]=[...new Set(entry_proc[t])],rep_hits_solo[t]=[],s[t])rep_hits_solo[t]=rep_hits_solo[t].concat(r(entry[s[t][n]][entry_idx.type]));rep_hits_solo[t]=[...new Set(rep_hits_solo[t])].filter(Number)}}function load_encrpyted_data(e){key_valid=1;var t=getCookie("pcsl_content_key");entry=JSON.parse(CryptoJS.AES.decrypt(entry_enc[e],t).toString(CryptoJS.enc.Utf8)),video=JSON.parse(CryptoJS.AES.decrypt(video_enc[e],t).toString(CryptoJS.enc.Utf8)),member_display_order=[7,6,5,3,4,2,1,12,10,9],$(".extra").removeClass("hidden"),$(".anti_extra").html(""),$(".anti_extra").addClass("hidden"),$("#home_key").removeClass("hidden"),removeCookie("pcsl_content_key"),setCookie("pcsl_content_key",t)}function memcount_load_rep(){clearInterval(memcount_rep_int);for(var e=[],t=[[],[]],s=0;s<15;++s)e[s]=[];for(var s in entry)e[entry[s][entry_idx.type]].push(entry[s][entry_idx.song_id]);for(var s in e)e[s].length>0&&(e[s]=[...new Set(e[s])].sort(((e,t)=>e-t)));for(var r=0;r<2;++r){for(s=0;s<song.length;++s){for(var n=0,i=[],a=0;a<3;++a)e[1<<a].includes(s)&&(n+=1<<a,i.push(1<<a));i.length<=1||e[n].push(s)}for(s=1;s<7;++s)for(var o=0;o<e[7].length;++o){-1!==(l=e[s].indexOf(e[7][o]))&&e[s].splice(l,1)}var _=[3,5,6];for(var s in _)for(var d=0;d<3;++d)if(!(!(1<<d)&_[s]))for(o=0;o<e[_[s]].length;++o){var l;-1!==(l=e[1<<d].indexOf(e[_[s]][o]))&&e[1<<d].splice(l,1)}for(var s in e)e[s].length>0&&(e[s]=[...new Set(e[s])].sort(((e,t)=>e-t)).filter(Number));for(var s in e)t[r][s]=e[s].length;if(key_valid&&0===r)for(s=0;s<8;++s)e[s]=e[s].concat(e[s+8])}var c='<table id="memcount_rep_table"><tr><th></th><th>加算✕</th>'+(key_valid?'<th class="table_empty_column"></th><th>加算〇</th>':"")+"</tr>";for(var s in member_display_order){var p=member_display_order[s];c+='<tr class="memcount_row singer_'+p+'"><td><div class="memcount_name">'+singer_lookup[p]+"</div></td>",c+="<td>"+t[0][p]+"</td>",key_valid&&(c+="<td></td><td"+(p>8?' class="memcount_empty"':"")+">"+(p>8?"":t[1][p])+"</td>"),c+="</tr>"}var u=[[t[1][7]+t[1][6]+t[1][5]+t[1][4],t[1][7]+t[1][6]+t[1][3]+t[1][2],t[1][7]+t[1][5]+t[1][3]+t[1][1]],[t[0][7]+t[0][6]+t[0][5]+t[0][4],t[0][7]+t[0][6]+t[0][3]+t[0][2],t[0][7]+t[0][5]+t[0][3]+t[0][1],t[0][12],t[0][10],t[0][9]]];c+='</table><div id="memcount_rep_sum_combined" class="memcount_sum"><div class="memcount_sum_icon"></div>';for(s=0;s<3;++s)c+='<div class="singer_'+(1<<2-s)+'">'+u[0][s]+"</div>";if(key_valid){c+='<div class="memcount_rep_sum_seperate memcount_btn"></div></div><div id="memcount_rep_sum_seperated" class="memcount_sum hidden"><div class="memcount_sum_icon col-1 colspan-2"></div>';for(var m=0;m<2;++m)for(var g=0;g<3;++g)c+='<div class="row-'+(m+1)+" col-"+(g+2)+" singer_"+((m?8:0)+(1<<2-g))+'">'+u[1][3*m+g]+"</div>";c+='<div class="memcount_rep_sum_combine memcount_btn col-5 colspan-2"></div>'}c+="</div>",$("#memcount_rep_content").html(c)}function display_date(e){var t="string"==typeof e?new Date(e):e;return t.getFullYear()+"-"+fill_digit(t.getMonth()+1,2)+"-"+fill_digit(t.getDate(),2)}function fill_digit(t,s){for(e=""+t;e.length<s;)e="0"+e;return e}function is_private(e){return entry[e][entry_idx.note].includes("非公開")||entry[e][entry_idx.note].includes("記録用")||entry[e][entry_idx.note].includes("アーカイブなし")}function bold(e,t){var s=e.toLowerCase().indexOf(t.toLowerCase());return-1===s||""===t?e:e.substring(0,s)+"<b>"+e.substring(s,s+t.length)+"</b>"+e.substring(s+t.length)}function copy_of(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function get_last_sang(e,t=7){for(var s=entry_proc[e].length-1;s>=0;--s)if(entry[entry_proc[e][s]][entry_idx.type]&t&hard_filter)return new Date(video[entry[entry_proc[e][s]][entry_idx.video]][video_idx.date]);return 0}function to8601(e){try{return new Date(e.substring(6),parseInt(e.substring(3,5))-1,e.substring(0,2))}catch{return console.log(e+" is not in dd-MM-yyyy format"),-1}}$(window).on("load",(async function(){var e=new URLSearchParams(window.location.search);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));else if(window.innerHeight/window.innerWidth<1.3)return $("#v_screen").addClass("post_switch"),$("#v_screen").height("100%"),$("#v_screen").width(.5625*window.innerHeight),$("#v_screen").attr("src","index.html"+window.location.search),$("body > div").addClass("post_switch"),$("body").addClass("post_switch"),e.delete("key"),void window.history.replaceState(null,null,"?"+e.toString());do{if(await getSHA384Hash(getCookie("pcsl_content_key"))===key_hash[1]){load_encrpyted_data(1);break}var t=e.get("key");if(""!==t&&await getSHA384Hash(t)===key_hash[1]){setCookie("pcsl_content_key",t),e.delete("key"),window.history.replaceState(null,null,"?"+e.toString()),load_encrpyted_data(1);break}if(await getSHA384Hash(getCookie("pcsl_content_key"))===key_hash[0]){load_encrpyted_data(0);break}if(""!==(t=e.get("key"))&&await getSHA384Hash(t)===key_hash[0]){setCookie("pcsl_content_key",t),e.delete("key"),window.history.replaceState(null,null,"?"+e.toString()),load_encrpyted_data(0);break}removeCookie("pcsl_content_key"),$(".extra").html("")}while(0);if(entry_enc=[null,null],video_enc=[null,null],""===getCookie("pcsl_settings_display")?(setCookie("pcsl_settings_display",100),setCookie("pcsl_settings_hidden",1),setCookie("pcsl_settings_clear",0),setCookie("pcsl_settings_random",0),setCookie("pcsl_settings_share",0)):(max_display=parseInt(getCookie("pcsl_settings_display")),do_display_hidden="1"===getCookie("pcsl_settings_hidden"),do_clear_input="1"===getCookie("pcsl_settings_clear"),do_random_anyway="1"===getCookie("pcsl_settings_random"),do_share_web="1"===getCookie("pcsl_settings_share"),$("#search_options_count_input").val(max_display),$("#search_options_btn_displayHidden").toggleClass("selected",do_display_hidden),$("#search_options_btn_reset").toggleClass("selected",do_clear_input),$("#search_options_btn_randomAnyway").toggleClass("selected",do_random_anyway),$("#search_options_btn_shareWeb").toggleClass("selected",do_share_web)),null!==e.get("hfilter")?setCookie("pcsl_settings_hfilter",hard_filter=parseInt(e.get("hfilter")),400):""!==getCookie("pcsl_settings_hfilter")&&(hard_filter=parseInt(getCookie("pcsl_settings_hfilter")),removeCookie("pcsl_settings_hfilter"),setCookie("pcsl_settings_hfilter",hard_filter,400)),init(),null!==e.get("sfilter")){var s=parseInt(e.get("sfilter")),r=[1&s?"":"nia",2&s?"":"momo",4&s?"":"kirara",8&s?"":"yuco",16&s?"":"shiro",32&s?"":"chui"];if("rep"===e.get("page"))for(var n in r)""!==r[n]&&$("#filter_"+r[n]+"_icon").click();if("search"===e.get("page")||null!==e.get("search"))for(var n in r)r[n].length&&$(".singer_icon.icon_"+r[n]).click()}var i=e.get("page");if("home"!==i&&-1===jump2page(i)&&jump2page("home"),null!==e.get("search")){"search"!==current_page&&jump2page("search");var a=e.get("search").split(",");if(a.length>1){var o=0;for(var n in a){var _=parseInt(a[n]);_>=1&&_<song.length&&(hits[o++]=song_lookup[_])}is_searching_from_rep=1,loading="!bulk_load_flag",update_display(1)}else a>=1&&a<song.length&&($("#input").val(song[song_lookup[a]][song_idx.name]),$("#input").blur())}$("#loading_overlay").addClass("hidden")})),$((function(){$(document).on("click","#nav_menu",(function(e){e.preventDefault(),prevent_menu_popup||($("#menu_container").toggleClass("hidden"),$("#nav_menu").toggleClass("menu_opened"),$(document.body).toggleClass("no_scroll"))})),$(document).on("click","#nav_to_top",(function(e){e.preventDefault(),prevent_menu_popup||($("html,body").animate({scrollTop:0},"fast"),"repertoire"===current_page&&rep_display_selected_first&&rep_display())})),$(document).on("click","#menu_container",(function(e){$(e.target).parents(".defog").length||$(e.target).hasClass("defog")||($("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))})),$(document).on("click",".menu2page",(function(e){var t=$(e.target).attr("id").replace("menu2page_","");t!==current_page&&(jump2page(t),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))})),$(document).on("click","#menu_count",(function(){if($("#popup_container").removeClass("hidden"),$("#memcount").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0,""===$("#memcount_content").html()){for(var e=[],t=0;t<16;++t)e[t]=[0,0,0];for(t=0;t<entry.length;++t)is_private(t)?e[entry[t][entry_idx.type]][2]++:entry[t][entry_idx.note].includes("【メン限")?e[entry[t][entry_idx.type]][1]++:e[entry[t][entry_idx.type]][0]++;var s='<table id="memcount_table"><tr><th></th><th>通常</th><th>メン限</th><th>非公開</th></tr>';for(var t in member_display_order){var r=member_display_order[t];s+='<tr class="memcount_row singer_'+r+'"><td><div class="memcount_name">'+singer_lookup[r]+"</div></td>";for(var n=0;n<3;++n)s+="<td"+(0===e[r][n]?' class="memcount_empty"':"")+">"+e[r][n]+"</td>";s+="</tr>"}var i=[[0,0,0],[0,0,0]];for(var t in entry)for(n=0;n<3;++n)1<<n&entry[t][entry_idx.type]&&i[entry[t][entry_idx.type]>8?1:0][n]++;s+='</table><div id="memcount_sum_combined" class="memcount_sum"><div class="memcount_sum_icon"></div>';for(t=2;t>=0;--t)s+='<div class="singer_'+(1<<t)+'">'+(i[0][t]+i[1][t])+"</div>";if(key_valid){s+='<div class="memcount_sum_seperate memcount_btn"></div></div><div id="memcount_sum_seperated" class="memcount_sum hidden"><div class="memcount_sum_icon col-1 colspan-2"></div>';for(var a=0;a<2;++a)for(var o=2;o>=0;--o)s+='<div class="row-'+(a+1)+" col-"+(4-o)+" singer_"+((a?8:0)+(1<<o))+'">'+i[a][o]+"</div>";s+='<div class="memcount_sum_combine memcount_btn col-5 colspan-2"></div>'}s+="</div>",$("#memcount_content").html(s),memcount_rep_int=setInterval(memcount_load_rep,1)}})),$(document).on("click","#menu_info",(function(){$("#popup_container").removeClass("hidden"),$("#information").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0})),$(document).on("click",".memcount_sum_seperate",(function(){$("#memcount_sum_seperated").removeClass("hidden"),$("#memcount_sum_combined").addClass("hidden")})),$(document).on("click",".memcount_sum_combine",(function(){$("#memcount_sum_combined").removeClass("hidden"),$("#memcount_sum_seperated").addClass("hidden")})),$(document).on("click",".memcount_rep_sum_seperate",(function(){$("#memcount_rep_sum_seperated").removeClass("hidden"),$("#memcount_rep_sum_combined").addClass("hidden")})),$(document).on("click",".memcount_rep_sum_combine",(function(){$("#memcount_rep_sum_combined").removeClass("hidden"),$("#memcount_rep_sum_seperated").addClass("hidden")})),$(document).on("click","#memcount",(function(e){"memcount"===$(e.target).attr("id")?($("#memcount").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1):$(e.target).hasClass("memcount_btn")||$(".memcount_subblock").toggleClass("hidden")})),$(document).on("click","#information",(function(e){"information"===$(e.target).attr("id")&&($("#information").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1)})),$(document).on("click","#home_key_reset",(function(){$("#popup_container").removeClass("hidden"),$("#remove_key").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).addClass("no_scroll"),prevent_menu_popup=!0})),$(document).on("click","#remove_key_yes",(function(){removeCookie("pcsl_content_key"),window.location=window.location.href.split("?")[0]})),$(document).on("click","#remove_key_nah",(function(){$("#remove_key").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1}))}));var today=(new Date).setHours(0,0,0,0);function get_date_different(e,t=today){return e="string"==typeof e?new Date(e):e,t=void 0===t?t:new Date(t),Math.round(Math.abs(e-t)/864e5)}function get_sang_count(e,t=7){var s=0,r=0;for(var n in entry_proc[e])entry[entry_proc[e][n]][entry_idx.type]&t&hard_filter&&(s++,entry[entry_proc[e][n]][entry_idx.note].includes("【メン限")&&r++);return[s,r]}function get_attr(e){var t=entry[e][entry_idx.note];return t.includes("ASMR弾き語り")?"asm":t.includes("弾き語り")?"gui":t.includes("アカペラ")?"aca":"oke"}function jump2page(e){switch(current_page=e="rep"===e?"repertoire":e,$(".menu2page_selected").removeClass("menu2page_selected"),$("#menu2page_"+e).addClass("menu2page_selected"),$(".section_container").addClass("hidden"),$("#"+e+"_section").removeClass("hidden"),$("#nav_dummy").addClass("hidden"),$("#nav_search_random").addClass("hidden"),$("#nav_bulk_search").addClass("hidden"),$("#nav_share").addClass("hidden"),$("#search_display").html(""),$("#rep_display").html(""),e){case"home":$("#nav_title").html("ホーム"),$("#nav_dummy").removeClass("hidden");break;case"search":$("#nav_search_random").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!is_searching_from_rep),$("#nav_title").html("曲検索"),$("#input").val(""),search();break;case"rep":case"repertoire":$("#repertoire_section").removeClass("hidden"),$("#nav_bulk_search").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!rep_selected.length),$("#nav_title").html("レパートリー"),rep_input_memory="",rep_search();break;default:return-1}$(window).scrollTop(0)}var copy_popup_is_displaying=!1;function copy_popup(){copy_popup_is_displaying||(copy_popup_is_displaying=!0,$("#copy_popup").attr("class","fade_out"),setTimeout((()=>{copy_popup_is_displaying=!1,$("#copy_popup").attr("class","hidden")}),1500))}const getSHA384Hash=async e=>{const t=(new TextEncoder).encode(e),s=await window.crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")};function setCookie(e,t,s=400){const r=new Date;r.setTime(r.getTime()+24*s*60*60*1e3);let n="expires="+r.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"}function getCookie(e){let t=e+"=",s=document.cookie.split(";");for(let e=0;e<s.length;e++){let r=s[e];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}function removeCookie(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}var attr_idx=["others","アニソン","ラブライブ","アイマス","マクロス","J-POP","ボカロ","ジブリ","特撮","ロック","歌謡曲","ポップス","R&B","キャラソン"],rep_list=[],rep_singer=[1,1,1],rep_part_singer=[1,1,1,1,1,1],rep_is_union=!0,rep_anisong={lovelive:[1,2],imas:[1,3],macros:[1,4],other:[1,1]},rep_genre={jpop:[1,5],voc:[1,6],jib:[1,7],tok:[1,8],rock:[1,9],kay:[1,10],pops:[1,11],rnb:[1,12],cha:[1,13],other:[1,0]},rep_sort="50",rep_sort_asd=!0,rep_display_selected_first=!1,rep_info="none",rep_edit_selected=-1,selected_member=7;$((function(){$(document).on("blur","#rep_input",(function(){rep_search()})),$(document).on("keydown",(function(e){13===e.keyCode&&"repertoire"===current_page&&$("#rep_input").blur()})),$(document).on("click",".filter_title",(function(){var e=$(this).attr("id").replace(/(filter_)|(_title)/g,"");$("#filter_"+e+"_close").toggleClass("closed"),$("#filter_"+e+"_content").toggleClass("hidden")})),$(document).on("click",".filter_icon",(function(){var e=-1;switch($(this).attr("class").split(/\s+/).find((e=>e.startsWith("icon_"))).replace("icon_","")){case"kirara":e=2;break;case"momo":e=1;break;case"nia":e=0;break;default:return}rep_singer[e]^=1,$(this).toggleClass("selected"),rep_search(!0)})),$(document).on("click",".filter_icon_extra",(function(){var e=-1;switch($(this).attr("class").split(/\s+/).find((e=>e.startsWith("icon_"))).replace("icon_","")){case"kirara":e=2;break;case"momo":e=1;break;case"nia":e=0;break;case"chui":e=5;break;case"shiro":e=4;break;case"yuco":e=3;break;default:return}(0<=e||e<=2)&&(rep_singer[e]^=1),rep_part_singer[e]^=1,$(this).toggleClass("selected"),rep_search(!0)})),$(document).on("click",".filter_singer_group",(function(){var e=$(this).attr("id").replace(/(filter_icon_)/,"");$("#singer_"+e).hasClass("selected")||(rep_is_union^=1,$(".singer_checkbox").removeClass("selected"),$("#singer_"+e).addClass("selected"),rep_search(!0))})),$(document).on("click",".filter_entry_attr_item",(function(){var e=$(this).attr("id").replace(/(attr_container_)/,"");if("all"===e)for(var t in $(".attr_checkbox").toggleClass("selected",!$("#attr_"+e).hasClass("selected")),rep_attr)rep_attr[t]=$("#attr_"+e).hasClass("selected")?1:0;else if($("#attr_"+e).toggleClass("selected"),rep_attr[e]^=1,$("#attr_"+e).hasClass("selected")){for(var t in rep_attr)if(!rep_attr[t])return void rep_search();$("#attr_all").addClass("selected")}else $("#attr_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_genre_anisong_item",(function(){var e=$(this).attr("id").replace(/(genre_container_anisong_)/,"");if("all"===e)for(var t in $(".genre_anisong_checkbox").toggleClass("selected",!$("#anisong_all").hasClass("selected")),rep_anisong)rep_anisong[t][0]=$("#anisong_all").hasClass("selected")?1:0;else if($("#anisong_"+e).toggleClass("selected"),rep_anisong[e][0]^=1,$("#anisong_"+e).hasClass("selected")){for(var t in rep_anisong)if(!rep_anisong[t][0])return void rep_search();$("#anisong_all").addClass("selected")}else $("#anisong_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_genre_general_item",(function(){var e=$(this).attr("id").replace(/(genre_container_general_)/,"");if("all"===e)for(var t in $(".genre_general_checkbox").toggleClass("selected",!$("#general_all").hasClass("selected")),rep_genre)rep_genre[t][0]=$("#general_all").hasClass("selected")?1:0;else if($("#general_"+e).toggleClass("selected"),rep_genre[e][0]^=1,$("#general_"+e).hasClass("selected")){for(var t in rep_genre)if(!rep_genre[t][0])return void rep_search();$("#general_all").addClass("selected")}else $("#general_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_sort_item",(function(){var e=$(this).attr("id").replace(/(sort_container_)/,"");rep_sort!==e&&($(".sort_checkbox").removeClass("selected"),$("#sort_"+e).addClass("selected"),rep_sort=e,update_rep_sort_display(),rep_display())})),$(document).on("click",".filter_sort2_item",(function(){rep_sort_asd^=1,update_rep_sort_display(),rep_display()})),$(document).on("click",".filter_sort3_item",(function(){rep_display_selected_first^=1,$(".sort3_checkbox").toggleClass("selected",rep_display_selected_first),rep_display()})),$(document).on("click",".filter_display_item",(function(){var e=$(this).attr("id").replace(/(display_container_)/,"");rep_info!==e&&($(".display_checkbox").removeClass("selected"),$("#display_"+e).addClass("selected"),rep_info=e,rep_display())})),$(document).on("click",".rep_song_container",(function(){var e=parseInt($(this).attr("id").replace(/(rep_song_)/,""));$(this).hasClass("selected")?(rep_selected.splice(rep_selected.indexOf(e),1),0===rep_selected.length&&($("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))):(rep_selected.push(e),$("#nav_share").removeClass("disabled"),$("#nav_bulk_search").removeClass("disabled")),$(this).toggleClass("selected")})),$(document).on("click","#nav_bulk_search",(function(){is_searching_from_rep=1,jump2page("search"),hits=copy_of(rep_selected),loading="!bulk_load_flag",$("#input").val(""),update_display(1)})),$(document).on("click","#nav_share",(function(){"repertoire"===current_page&&($(this).hasClass("disabled")||prevent_menu_popup||(prevent_menu_popup=!0,$(document.body).toggleClass("no_scroll"),$("#rep_list").removeClass("hidden"),$("#popup_container").removeClass("hidden"),rep_update_list()))})),$(document).on("click","#rep_list_artist",(function(){$("#rep_list_artist").hasClass("disabled")||($("#list_artist_cb").toggleClass("selected"),rep_update_list())})),$(document).on("click","#rep_list_edit",(function(){0!==rep_selected.length&&(-1===rep_edit_selected?($("#rep_list_edit").html("編集終了"),$("#rep_list_artist").addClass("disabled"),$("#rep_list_close").addClass("disabled"),$("#rep_compose_tweet").addClass("disabled"),$("#rep_list_leftbar").removeClass("hidden"),$("#rep_list_container").addClass("editing"),rep_edit_selected=-2,rep_update_leftbar()):($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1))})),$(document).on("click",".rep_list_item",(function(){var e=parseInt($(this).attr("id").replace(/(rep_btn_)/,""));switch(rep_edit_selected){case-1:return;case-2:rep_edit_selected=e,rep_update_leftbar();break;case e:rep_edit_selected=-2,rep_update_leftbar();break;default:if($(this).hasClass("arrow_up")){[rep_selected[e],rep_selected[e+1]]=[rep_selected[e+1],rep_selected[e]],rep_edit_selected--,rep_update_list(),rep_update_leftbar();var t=Math.max(0,rep_edit_selected-1),s=$("#rep_list_leftbar").offset().top,r=$("#rep_btn_"+t).offset().top;r<s&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-s+r),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}if($(this).hasClass("arrow_down")){[rep_selected[e-1],rep_selected[e]]=[rep_selected[e],rep_selected[e-1]],rep_edit_selected++,rep_update_list(),rep_update_leftbar();t=Math.min(rep_edit_selected+1,rep_selected.length-1);var n=$("#rep_list_leftbar").offset().top+$("#rep_list_leftbar").height(),i=$("#rep_btn_"+t).offset().top+$("#rep_btn_"+t).height();i>n&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-n+i),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}}})),$(document).on("click",".rep_list_delete",(function(){rep_edit_selected>=0&&($("#rep_song_"+rep_selected[rep_edit_selected]).removeClass("selected"),rep_selected.splice(rep_edit_selected,1)),rep_edit_selected=-2,rep_update_list(),rep_update_leftbar(),0===rep_selected.length&&($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1,$("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))})),$("#rep_list_content").on("scroll",(function(){$("#rep_list_leftbar").scrollTop($("#rep_list_content").scrollTop())})),$(document).on("click","#rep_list_close",(function(){$("#rep_list_close").hasClass("disabled")||(prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll"))})),$(document).on("click","#rep_compose_tweet",(function(){if(!$("#rep_compose_tweet").hasClass("disabled")&&0!==rep_selected.length){prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll");var e="";for(var t in rep_selected)e+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e),"_blank")}})),$(document).on("click","#rep_copy",(function(){var e="";for(var t in rep_selected)e+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";navigator.clipboard.writeText(e),copy_popup()}))}));var reb_display_inter,rep_hits=[],rep_hits_solo=[],rep_hits_count=0,rep_selected=[],rep_input_memory="";function rep_search(e=!1){var t=$("#rep_input").val().normalize("NFKC").trim();if(t!==rep_input_memory)rep_input_memory=t;else if(!e&&""!==t)return;if(""===rep_input_memory){for(var s in selected_member=0,rep_singer)selected_member+=rep_singer[s]<<s;if(0!==selected_member){var r=0;for(var s in rep_hits=[],rep_hits_count=0,rep_anisong)r+=rep_anisong[s][0]<<rep_anisong[s][1];for(var s in rep_genre)r+=rep_genre[s][0]<<rep_genre[s][1];var n=0;for(var s in rep_anisong)"other"!==s&&(n+=1-rep_anisong[s][0]<<rep_anisong[s][1]);for(s=0;s<song.length;++s)if(song[s][song_idx.attr]&r){if(0!=n&&song[s][song_idx.attr]&n)continue;if(rep_is_union?!(selected_member&rep_list[s]):selected_member!==rep_list[s])continue;rep_hits[rep_hits_count++]=s}rep_display()}else $("#rep_display").html("")}else{rep_hits=[],rep_hits_count=0;for(var s=1;s<song.length;++s)0!==entry_proc[s].length&&(-1===processed_song_name[s].search(t.toLowerCase())&&-1===song[s][song_idx.reading].search(t)||(rep_hits[rep_hits_count++]=s));rep_display()}}function rep_display(){if(rep_display_selected_first)for(var e in rep_selected)-1!==rep_hits.indexOf(rep_selected[e])&&rep_hits.splice(rep_hits.indexOf(rep_selected[e]),1);switch(selected_member&=hard_filter,$("#rep_display").html(""),rep_sort){case"50":rep_hits.sort(((e,t)=>e-t)),rep_sort_asd||rep_hits.reverse();break;case"count":var t=[];for(var e in song)if(7!==selected_member)for(var s in t[e]=0,entry_proc[e])entry[entry_proc[e][s]][entry_idx.type]&selected_member&&t[e]++;else t[e]=entry_proc[e].length;rep_hits.sort(((e,s)=>(rep_sort_asd?1:-1)*(t[s]-t[e])));break;case"date":var r=[];for(var e in song){var n=get_last_sang(e,selected_member);r[e]=n?n.getTime():0}rep_hits.sort(((e,t)=>(rep_sort_asd?1:-1)*(r[t]-r[e])));break;case"release":for(r=[],e=1;e<song.length;++e)r[e]=to8601(song[e][song_idx.release]).getTime();rep_hits.sort(((e,t)=>(rep_sort_asd?1:-1)*(r[t]-r[e])));break;default:return void console.log('rep_sort of type "'+rep_sort+'" not found')}rep_display_selected_first&&(rep_hits=rep_selected.concat(rep_hits)),rep_loading_progress=0,rep_display_loop(),reb_display_inter=setInterval(rep_display_loop,10)}var rep_loading_progress=0;function rep_display_loop(){for(var e=Math.min(rep_loading_progress+20,rep_hits.length),t=rep_loading_progress;t<e;++t){var s=get_sang_count(rep_hits[t],selected_member),r='<div class="rep_song_container'+(rep_selected.includes(rep_hits[t])?" selected":"")+(s[0]>0&&s[0]===s[1]?" rep_mem_only":"")+'" id="rep_song_'+rep_hits[t]+'">';r+='<div class="rep_song_title">'+song[rep_hits[t]][song_idx.name]+" / "+song[rep_hits[t]][song_idx.artist]+"</div>",r+='<div class="rep_song_info grid_block-4">';var n=get_last_sang(rep_hits[t],selected_member),i=0===n?-1:get_date_different(n);switch(r+="<div>"+(0===i?"今日":-1===i?"---":i+"日前")+"</div>",r+="<div>"+s[0]+"回"+(s[1]>0?s[0]===s[1]?" (メン限のみ)":" ("+s[1]+"回メン限)":"")+"</div>",r+='<div class="rep_song_singer'+(key_valid?" rep_singer_2rows":"")+'"><div class="'+(rep_hits_solo[rep_hits[t]].includes(4)?"rep_song_kirara":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(2)?"rep_song_momo":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(1)?"rep_song_nia":"rep_song_empty")+'"></div>'+(key_valid?'<div class="'+(rep_hits_solo[rep_hits[t]].includes(12)?"rep_song_chui":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(10)?"rep_song_shiro":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(9)?"rep_song_yuco":"rep_song_empty")+'"></div>':"")+"</div>",rep_info){case"release":r+='<div class="rep_extra_info"> ('+display_date(to8601(song[rep_hits[t]][song_idx.release]))+")</div>";break;case"attrdata":var a={asm:0,gui:0,aca:0};for(var o in entry_proc[rep_hits[t]])entry[entry_proc[rep_hits[t]][o]][entry_idx.type]&selected_member&&a[get_attr(entry_proc[rep_hits[t]][o])]++;r+='<div class="rep_extra_info grid_block-3"><div class="row-1 col-1">'+(a.asm>0?"A弾"+a.asm:"")+'</div><div class="row-1 col-2">'+(a.gui>0?"弾"+a.gui:"")+'</div><div class="row-1 col-3">'+(a.aca>0?"アカ"+a.aca:"")+"</div></div>";case"none":r+="<div></div>"}$("#rep_display").append(r+"</div></div>")}(rep_loading_progress+=20)>=rep_hits.length&&clearInterval(reb_display_inter)}function rep_update_list(){for(var e="",t=0;t<rep_selected.length;++t)e+='<div id="rep_btn_'+t+'" class="rep_list_item"></div>';$("#rep_list_leftbar").html(e),e="";var s=$("#list_artist_cb").hasClass("selected"),r=0;for(t=0;t<rep_selected.length;++t){var n=song[rep_selected[t]][song_idx.name]+(s?" / "+song[rep_selected[t]][song_idx.artist]:"");for(var i in e+='<div id="list_'+t+'">'+n+"</div>",n)r+=/[ -~]/.test(n[i])?1:2;r++}$("#rep_list_content").html(e),$(".rep_list_wordcount").html("長さ<br />"+r+"/280"),$(".rep_list_wordcount").toggleClass("red_text",r>280)}function rep_update_leftbar(){$(".rep_list_item").attr("class","rep_list_item"),$(".rep_list_delete").addClass("hidden"),rep_edit_selected>=0&&($(".rep_list_item").addClass("blank"),rep_edit_selected>0&&$("#rep_btn_"+(rep_edit_selected-1)).attr("class","rep_list_item arrow_up"),$("#rep_btn_"+rep_edit_selected).attr("class","rep_list_item"),rep_edit_selected<rep_hits.length-1&&$("#rep_btn_"+(rep_edit_selected+1)).attr("class","rep_list_item arrow_down"),$(".rep_list_delete").removeClass("hidden"))}function update_rep_sort_display(){var e="";switch(rep_sort){case"50":e=rep_sort_asd?"正順 (⇌逆順)":"逆順 (⇌正順)";break;case"count":e=rep_sort_asd?"多い順 (⇌少ない順)":"少ない順 (⇌多い順)";break;case"date":case"release":e=rep_sort_asd?"新しい順 (⇌古い順)":"古い順 (⇌新しい順)";break;default:return 1}$("#sort_name_sort").html(e)}var auto_display_max,loading="",singer_chosen=[1,1,1],part_filter=[1,1,1,1,1,1],part_rom=[1,2,4,9,10,12],hide_song=new Array,searching_song_name=!0,search_sort_by_date=!0,search_sort_asd=!0,is_searching_from_rep=!1;$((function(){$(document).on("click","#nav_search_random",(function(){if((!$(this).hasClass("disabled")||do_random_anyway)&&!prevent_menu_popup){var e,t=trial=0,s=7;for(var r in singer_chosen)singer_chosen[r]||(s-=1<<r);if(0!==(s&=hard_filter)){do{for(var r in e=Math.floor(Math.random()*song.length),entry_proc[e])if((7===s||s&entry[entry_proc[e][r]][entry_idx.type])&&(do_display_hidden||!is_private(entry_proc[e][r]))){t++;break}}while(0===t);$("#input").val(song[e][song_idx.name]),is_searching_from_rep=0,search()}}})),$(document).on("click","#nav_share",(function(){if("search"===current_page&&!$(this).hasClass("disabled")){for(var e="szk31.github.io/pcsl/?search="+song_lookup.indexOf(hits[0]),t=1;t<hits.length;++t)e+=","+song_lookup.indexOf(hits[t]);navigator.clipboard.writeText(e),copy_popup()}})),$(document).on("input","#input",(function(){auto_search()})),$(document).on("mousedown",".auto_panel",(function(){var e=$(this).attr("id");$("#input").val(e)})),$(document).on("blur","#input",(function(){$("#search_auto").addClass("hidden"),is_searching_from_rep?is_searching_from_rep=0:$("#nav_share").toggleClass("disabled",!is_searching_from_rep),search()})),$(document).on("keydown",(function(e){13===e.keyCode&&"search"===current_page&&$("#input").blur()})),$(document).on("focus","#input",(function(e){(do_clear_input||"!bulk_load_flag"===loading)&&($(e.target).val(""),$("#nav_search_random").removeClass("disabled"),$("#nav_share").addClass("disabled")),auto_search()})),$(document).on("click","#search_options_button",(function(){$("#search_options_button").toggleClass("opened"),$("#search_options_container").toggleClass("hidden")})),$(document).on("click",".singer_icon",(function(){var e=parseInt($(this).attr("class").split(/\s+/).find((e=>e.startsWith("sing_sel_"))).replace("sing_sel_","")),t=part_rom.indexOf(e);0<=t&&t<=2&&(singer_chosen[t]^=1),part_filter[t]^=1,$(".sing_sel_"+e).toggleClass("selected"),loading="",search()})),$(document).on("click",".search_option_group1",(function(){var e="songname"===$(this).attr("id").replace(/(search_options_)/,"");e!==searching_song_name&&(searching_song_name=e,$(".search_option_group1>.radio").toggleClass("selected"),$("#input").val(""),$("#nav_share").addClass("disabled"),$("#input").attr("placeholder",searching_song_name?"曲名/読みで検索":"アーティスト名で検索"),$("#search_display").html(""),loading="",$("#nav_search_random").toggleClass("disabled",!searching_song_name))})),$(document).on("click",".search_option_group2",(function(){var e="date"===$(this).attr("id").replace(/(search_options_)/,"");search_sort_by_date!==e&&(search_sort_by_date=e,$(".search_option_group2>.radio").toggleClass("selected"),update_display(),$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"))})),$(document).on("click",".search_option_group3",(function(){search_sort_asd^=1,$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"),update_display()})),$(document).on("input","#search_options_count_input",(function(){max_count_update(this)})),$(document).on("blur","#search_options_count_input",(function(){var e=Math.min(400,Math.max(1,parseInt($("#search_options_count_input").val())));$("#search_options_count_input").val(e),max_display=e,update_display(),setCookie("pcsl_settings_display",e)})),$(document).on("keydown",(function(e){13===e.keyCode&&$("#search_options_count_input").blur()})),$(document).on("click",".search_option_group4",(function(){var e=$(this).attr("id").replace(/(search_options_)/,"");switch($("#search_options_btn_"+e).toggleClass("selected"),e){case"displayHidden":do_display_hidden^=1,update_display(),setCookie("pcsl_settings_hidden",do_display_hidden?1:0);break;case"reset":setCookie("pcsl_settings_clear",(do_clear_input^=1)?1:0);break;case"randomAnyway":do_random_anyway^=1,$("#nav_search_random").toggleClass("disabled",!searching_song_name||!do_random_anyway&&""!==loading),setCookie("pcsl_settings_random",do_random_anyway?1:0);break;case"shareWeb":do_share_web^=1,setCookie("pcsl_settings_share",do_random_anyway?1:0)}})),$(document).on("click",".song_name_container",(function(e){if(!$(e.target).hasClass("song_copy_icon")){var t=parseInt($(this).attr("id"));hide_song.includes(t)?hide_song.splice(hide_song.indexOf(t),1):hide_song.push(t),$(".song_"+t).toggleClass("hidden"),$("#fold_"+t).toggleClass("closed")}})),$(document).on("click",".song_copy_icon",(function(){var e=parseInt($(this).attr("id").replace("copy_name_",""));navigator.clipboard.writeText(song[e][song_idx.name]),copy_popup()})),$(document).on("click",".entry_share",(function(){var e=parseInt($(this).attr("id").replace("entry_",""));const t="https://www.youtube.com/watch?v="+video[entry[e][entry_idx.video]][video_idx.id];fetch("https://noembed.com/embed?dataType=json&url="+t).then((e=>e.json())).then((function(t){if(void 0!==t.title){var s="";s=0===entry[e][entry_idx.time]?t.title+"\n(youtu.be/"+video[entry[e][entry_idx.video]][video_idx.id]+")":song[entry[e][entry_idx.song_id]][song_idx.name].trim()+" / "+song[entry[e][entry_idx.song_id]][song_idx.artist]+" @"+t.title+"\n(youtu.be/"+video[entry[e][entry_idx.video]][video_idx.id]+timestamp(e)+")",do_share_web&&(s+="\n\nszk31.github.io/pcsl/?search="+song_lookup.indexOf(entry[e][entry_idx.song_id])+"より"),window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(s),"_blank")}else alert((entry[e][entry_idx.note].includes("【非公開】")?"非公開":"再アップの")+"動画を共有しないで下さい。")}))}))}));var hits=[];function auto_search(){var e=$("#input").val().normalize("NFKC").toLowerCase().trim();if(""!==e&&searching_song_name){var t=[],s=[],r=0,n=0;for(var i in series_lookup)for(var a in series_lookup[i]){if(-1!==series_lookup[i][a].indexOf(e)){t[r++]=i;break}}if(/[^\u3040-\u309F\u30FC\u30F4]/.test(e)){for(i=1;i<song.length;++i)if(!(i>2&&song[i][song_idx.name].trim()===song[i-1][song_idx.name].trim())){switch(song[i][song_idx.name].toLowerCase().indexOf(e)){case 0:entry_proc[i].length>0&&(t[r++]=i);break;case-1:break;default:entry_proc[i].length>0&&(s[n++]=i)}if(r>=auto_display_max)break}}else for(var i=1;i<song.length;++i)if(!(i>2&&song[i][song_idx.name].trim()===song[i-1][song_idx.name].trim())){switch(song[i][song_idx.reading].indexOf(e)){case 0:entry_proc[i].length>0&&(t[r++]=i);break;case-1:break;default:entry_proc[i].length>0&&(s[n++]=i)}if(r>=auto_display_max)break}var o=0,_="";for(var i in t){var d,l,c;if(isNaN(parseInt(t[i])))d="",l=c=t[i];else{var p=song[t[i]][song_idx.reading];d=-1===p.indexOf(" ")?bold(p,e):bold(p.substring(0,p.indexOf(" ")),e),l=bold(c=song[t[i]][song_idx.name],e)}_+='<div id="'+c+'" class="auto_panel'+(0===o?" auto_first":"")+'"><div class="auto_reading">'+d+'</div><div class="auto_display">'+l+"</div></div>",o++}for(var i in s)if(_+='<div id="'+song[s[i]][song_idx.name]+'" class="auto_panel'+(0===o?" auto_first":"")+'"><div class="auto_reading"></div><div class="auto_display">'+bold(song[s[i]][song_idx.name],e)+"</div></div>",++o>=auto_display_max)break;$("#search_auto").html(_),""!==_?$("#search_auto").removeClass("hidden"):$("#search_auto").addClass("hidden")}else $("#search_auto").addClass("hidden")}function search(){if(is_searching_from_rep)update_display();else{var e=$("#input").val().trim();if(e!==loading){if(loading=e,""===e)return $("#search_display").html(""),void $("#nav_search_random").removeClass("disabled");do_random_anyway||$("#nav_search_random").addClass("disabled"),e=e.normalize("NFKC").toLowerCase();var t="";for(var s in series_lookup){for(var r in series_lookup[s])if(series_lookup[s].includes(e)){t=s;break}if(""!==t)break}var n=0;if(""!=t){var i=[2,3,4,7];for(var s in i)if(attr_idx[i[s]]===t){n=i[s];break}}hits=[];for(s=1;s<song.length&&200!==hits.length;++s)if(searching_song_name)if(""!==t){if(song[s][song_idx.reading].includes(t)){hits.push(s);continue}n&&1<<n&song[s][song_idx.attr]&&hits.push(s)}else(processed_song_name[s].includes(e)||song[s][song_idx.reading].toLowerCase().includes(e))&&hits.push(s);else song[s][song_idx.artist].toLowerCase().includes(e)&&hits.push(s);$("#nav_share").toggleClass("disabled",searching_song_name||0===hits),hits.sort((function(t,s){return song[t][song_idx.name].trim().toLowerCase()===e?song[s][song_idx.name].trim().toLowerCase()===e?0:-1:song[s][song_idx.name].trim().toLowerCase()===e?1:void 0})),update_display()}}}function update_display(e=!1){if(e|=is_searching_from_rep,$("#search_auto").addClass("hidden"),""!==loading||e){var t=-1;for(var s in singer_chosen)singer_chosen[s]||1<<s;hard_filter;var r=[],n=0,i="",a=0,o=0;for(s=0;s<hits.length;++s){var _=[];o+=(_=search_sort_by_date?entry_proc[hits[s]].sort(((e,t)=>search_sort_asd?e-t:t-e)):entry_proc[hits[s]].sort(((e,t)=>entry[e][entry_idx.type]===entry[t][entry_idx.type]?e-t:(search_sort_asd?1:-1)*(display_order[entry[e][entry_idx.type]]-display_order[entry[t][entry_idx.type]])))).length;for(var d=0;d<_.length;++d){var l=_[d],c=!1;for(var p in part_filter)if(!part_filter[p]&&((8|part_rom[p])&entry[l][entry_idx.type])===part_rom[p]){c=!0;break}if(!(c||!do_display_hidden&&is_private(l))){if(t!==entry[l][entry_idx.song_id]){i+=(-1!==t?"</div>":"")+'<div class="song_container">',t=entry[l][entry_idx.song_id],r[n++]=t;var u=!hide_song.includes(t),m=song[t][song_idx.name].normalize("NFKC"),g=0;for(p=0;p<m.length;++p)g+=/[ -~]/.test(m.charAt(p))?1:2;"secret base ~君がくれたもの~"===m&&(g=0),"みくみくにしてあげる♪【してやんよ】"===m&&(m="みくみくにしてあげる♪<br />【してやんよ】"),/([^~]+~+[^~])/g.test(m)&&g>=28&&(m=m.substring(0,m.search(/~/g))+"<br />"+m.substring(m.search(/~/g))),i+='<div class="song_name_container '+(n%2?"odd_colour":"even_colour")+'" id="'+t+'"><div class="song_rap"><div class="song_name">'+m+'</div><div class="song_credit'+(u?"":" hidden")+(song[t][song_idx.artist].length>30?" long_credit":"")+" song_"+t+'">'+song[t][song_idx.artist]+'</div></div><div class="song_icon_container"><div id="fold_'+t+'" class="song_fold_icon'+(u?"":" closed")+'"></div><div id="copy_name_'+t+'" class="song_copy_icon song_'+t+(u?"":" hidden")+'"></div></div></div>'}var h=entry[l][entry_idx.note].includes("【メン限"),v=""===entry[l][entry_idx.note]||"【メン限】"===entry[l][entry_idx.note]||"【メン限アーカイブ】"===entry[l][entry_idx.note],f=entry[l][entry_idx.note];if(h&&(f=f.includes("メン限アーカイブ")?f.replace(/【メン限アーカイブ】/g,""):f.replace(/【メン限】/g,"")),i+='<div class="entry_container singer_'+entry[l][entry_idx.type]+(h?"m":"")+" song_"+t+(hide_song.includes(t)?" hidden":"")+'"><a href="https://youtu.be/'+video[entry[l][entry_idx.video]][video_idx.id]+timestamp(l)+'" target="_blank"><div class="entry_primary"><div class="entry_date">'+display_date(video[entry[l][entry_idx.video]][video_idx.date])+'</div><div class="entry_singer">'+singer_lookup[entry[l][entry_idx.type]]+'</div><div class="mem_display">'+(h?"メン限":"")+'</div><div class="entry_share" id="entry_'+l+'" onclick="return false;"></div></div>'+(v?"":'<div class="entry_note">'+f+"</div>")+"</a></div>",++a>=max_display){s=200;break}}}}do{if(""!==i)break;if(0===hits.length){i+='<div class="search_no_result">曲検索結果なし';break}if(o>0){i+='<div class="search_no_result">非表示動画のみ';break}i+='<div class="search_no_result">歌記録なし'}while(0);$("#search_display").html(i+"</div>");for(s=0;s<hide_song.length;++s)r.includes(hide_song[s])||hide_song.splice(s--,1)}}function timestamp(e){return 0===entry[e][entry_idx.time]?"":"?t="+entry[e][entry_idx.time]}function max_count_update(e){var t=e.selectionStart,s=e.selectionEnd,r=$(e).val();r=r.replace(/[^\d]/g,"").substring(0,3),$("#search_options_count_input").val(r),e.setSelectionRange(t,s)}