var video,entry,memcount_rep_int,auto_display_max,longpress_timer,post_longpress_timer,rep_display_inter,singer_lookup=["reserved","看谷にぃあ","胡桃澤もも","ももにぃあ","逢魔きらら","きらにぃあ","ももきら","ぷちここ",null,"つきみゆこ","愛白ふりる",null,"小悪熊ちゅい"],display_order=[-1,7,6,4,5,3,2,1,-1,14,13,11,12,10,9,8],member_display_order=[7,6,5,3,4,2,1],series_lookup={マクロス:["マクロス","まくろす"],ラブライブ:["ラブライブ","らぶらいぶ","LL","ll"],アイマス:["アイマス","あいます","デレマス","でれます"],ジブリ:["ジブリ","じぶり"],物語シリーズ:["物語シリーズ","ものがたりしりーず","ものがたりシリーズ"],まどマギ:["まどマギ","まどまぎ","まどか"],disney:["disney","ディズニー","でぃずにー","Disney"]},entry_idx={song_id:0,video:1,note:2,time:3,type:4},song_idx={name:0,artist:1,reading:2,attr:3,release:4,reference:5},video_idx={id:0,date:1},version="1.6.3",key_hash=["473c05c1ae8349a187d233a02c514ac73fe08ff4418429806a49f7b2fe4ba0b7a36ba95df1d58b8e84a602258af69194","3f01e53f1bcee58f6fb472b5d2cf8e00ce673b13599791d8d2d4ddcde3defbbb4e0ab7bc704538080d704d87d79d0410"],prevent_menu_popup=!1,current_page="home",key_valid=0,max_display=100,do_display_hidden=!0,do_select_input=!0,do_random_anyway=!1,hard_filter=7,do_share_web=!1,do_show_random=!1,do_show_release=!1,entry_proc=[],processed_song_name=[""],theme=localStorage.getItem("theme");function process_data(){$("#loading_text").html("Processing data...");var s=new URLSearchParams(window.location.search);if(s.delete("key"),window.history.pushState(null,null,`${document.location.href.split("?")[0]}${s.size?`?${s}`:""}`),""!==getCookie("pcsl_settings_display")?(do_display_hidden="1"===getCookie("pcsl_settings_hidden"),do_select_input="1"===getCookie("pcsl_settings_clear"),do_random_anyway="1"===getCookie("pcsl_settings_random"),do_share_web="1"===getCookie("pcsl_settings_share"),localStorage.setItem("pcsl_s_showHidden",getCookie("pcsl_settings_hidden")),localStorage.setItem("pcsl_s_selecInput",getCookie("pcsl_settings_clear")),localStorage.setItem("pcsl_s_showRandom","0"),localStorage.setItem("pcsl_s_ignoreRule",getCookie("pcsl_settings_random")),localStorage.setItem("pcsl_s_showReleas","0"),removeCookie("pcsl_settings_hidden"),removeCookie("pcsl_settings_clear"),removeCookie("pcsl_settings_random"),removeCookie("is_mobile"),removeCookie("pcsl_settings_display"),removeCookie("pcsl_settings_select"),removeCookie("pcsl_settings_share")):null===localStorage.getItem("pcsl_s_showHidden")?(localStorage.setItem("pcsl_s_showHidden","1"),localStorage.setItem("pcsl_s_selecInput","1"),localStorage.setItem("pcsl_s_showRandom","0"),localStorage.setItem("pcsl_s_ignoreRule","0"),localStorage.setItem("pcsl_s_showReleas","0")):(do_display_hidden="1"===localStorage.getItem("pcsl_s_showHidden"),do_select_input="1"===localStorage.getItem("pcsl_s_selecInput"),do_show_random="1"===localStorage.getItem("pcsl_s_showRandom"),do_random_anyway="1"===localStorage.getItem("pcsl_s_ignoreRule"),do_show_release="1"===localStorage.getItem("pcsl_s_showReleas")),do_display_hidden||$("#setting_hidden>div").toggleClass("selected"),do_select_input||$("#setting_select>div").toggleClass("selected"),do_show_random&&$("#setting_random>div").toggleClass("selected"),do_random_anyway&&$("#setting_ignore>div").toggleClass("selected"),do_show_release&&$("#setting_release>div").toggleClass("selected"),$("#nav_search_random").addClass("blank",!do_show_random),$(".setting_req_random").toggleClass("disabled",!do_show_random),init(),null!==s.get("sfilter")){var t=parseInt(s.get("sfilter")),r=[1&t?"":"nia",2&t?"":"momo",4&t?"":"kirara",8&t?"":"yuco",16&t?"":"shiro",32&t?"":"chui"];if("rep"===s.get("page")||null!==s.get("rfilter"))for(var n in r)""!==r[n]&&$(`.filter_icon${key_valid?"_extra":""}.icon_`+r[n]).click();if("search"===s.get("page")||null!==s.get("search"))for(var n in r)r[n].length&&$(".singer_icon.icon_"+r[n]).click()}var i=s.get("page");if("home"!==i&&-1===jump2page(i)&&jump2page("home"),null!==s.get("search")){"search"!==current_page&&jump2page("search");var a=s.get("search").split(",");if(a.length>1){var o=0;for(var n in a){var l=parseInt(a[n]);l>=1&&l<song.length&&(hits[o++]=song_lookup[l])}is_searching_from_rep=1,loading="!bulk_load_flag",update_display(1)}else a>=1&&a<song.length&&($("#input").val(song[song_lookup[a]][song_idx.name]),$("#input").blur())}if(null!==s.get("rfilter")){"repertoire"!==current_page&&jump2page("rep");for(var d=[],l=parseInt(s.get("rfilter")),c=0;l;)l%2&&d.push(c),l>>=1,c++;for(var n in rep_anisong)d.includes(rep_anisong[n][1])||$("#anisong_"+n).click();for(var n in rep_genre)d.includes(rep_genre[n][1])||$("#general_"+n).click()}$("#loading_text").html("Loading Complete.<br />You can't see this tho"),$("#loading_overlay").addClass("hidden")}function init(){$("#input").val("");{let s=new Date("2021-01-01");function t(t){var r=new Date(s);return r.setDate(s.getDate()+t),r.toISOString().slice(0,10)}for(var r in video)video[r][video_idx.date]=t(video[r][video_idx.date]);for(var r in entry)entry[r][entry_idx.note]=note_index[entry[r][entry_idx.note]];note_index=null}for(var r in song)entry_proc[r]=[];for(var r=0;r<entry.length;++r)entry[r][entry_idx.type]&hard_filter&&entry_proc[entry[r][0]].push(r);$("#info_version").html(version),$("#info_last-update").html(video[video.length-1][video_idx.date]),auto_display_max=Math.floor(5*Math.pow(window.innerHeight/window.innerWidth,1.41421356237));for(var n=[],r=1;r<song.length;++r)processed_song_name.push(song[r][song_idx.name].toLowerCase().normalize("NFKC"));for(var r=0;r<song.length;++r){for(var i in rep_list[r]=0,entry_proc[r]){if((7&rep_list[r])==7)break;rep_list[r]|=entry[entry_proc[r][i]][entry_idx.type]}for(var i in rep_list[r]&=-9,n[r]=[...new Set(entry_proc[r])],rep_hits_solo[r]=[],n[r])rep_hits_solo[r]=rep_hits_solo[r].concat(split_to_solo(entry[n[r][i]][entry_idx.type]));rep_hits_solo[r]=[...new Set(rep_hits_solo[r])].filter(Number)}}function memcount_load_rep(){clearInterval(memcount_rep_int);for(var s=[],t=0;t<15;++t)s[t]=[];for(var t in rep_hits_solo)for(var r in rep_hits_solo[t]){var n=split_to_solo(rep_hits_solo[t][r]);for(var i in n)s[n[i]].push(t)}s.map(s=>[...new Set(s)]);for(var a=[s[4].length,s[2].length,s[1].length,s[12].length,s[10].length,s[9].length,new Set([...s[4],...s[12]]).size,new Set([...s[2],...s[10]]).size,new Set([...s[1],...s[9]]).size],o=[4,2,1,12,10,9,4,2,1],l="",t=0;t<(key_valid?6:3);++t)l+='<div class="memcount_rep_block"><div class="singer_'+o[t]+'m">'+singer_lookup[o[t]]+'</div><div class="singer_'+o[t]+'">'+a[t]+"</div></div>";if(key_valid){l+='<div></div><div class="memcount_rep_sum"></div><div></div>';for(var t=6;t<9;++t)l+='<div class="memcount_rep_block_sum memcount_rep_singer_'+o[t]+'"><div>'+a[t]+"</div></div>"}$("#memcount_rep_content").toggleClass("extra_content",1===key_valid),$("#memcount_rep_content").html(l)}function display_date(s){var t="string"==typeof s?new Date(s):s;return t.getFullYear()+"-"+fill_digit(t.getMonth()+1,2)+"-"+fill_digit(t.getDate(),2)}function fill_digit(s,t){for(e=""+s;e.length<t;)e="0"+e;return e}function is_private(s){return entry[s][entry_idx.note].includes("非公開")||entry[s][entry_idx.note].includes("記録用")||entry[s][entry_idx.note].includes("アーカイブなし")}function bold(s,t){var r=s.toLowerCase().indexOf(t.toLowerCase());return -1===r||""===t?s:s.substring(0,r)+"<b>"+s.substring(r,r+t.length)+"</b>"+s.substring(r+t.length)}function copy_of(s){return"object"==typeof s?JSON.parse(JSON.stringify(s)):s}function get_last_sang(s,t=[4,2,1,12,10,9]){for(var r=entry_proc[s].length-1;r>=0;--r)if(t.some(t=>(t&entry[entry_proc[s][r]][entry_idx.type])===t))return new Date(video[entry[entry_proc[s][r]][entry_idx.video]][video_idx.date]);return 0}function to8601(s){try{return new Date(s.substring(6),parseInt(s.substring(3,5))-1,s.substring(0,2))}catch{return console.log(s+" is not in dd-MM-yyyy format"),-1}}null===theme&&(theme="mixed",localStorage.setItem("theme","mixed")),document.documentElement.setAttribute("theme",theme),document.addEventListener("DOMContentLoaded",async function(){function s(s){return n?CryptoJS.AES.decrypt(s,t).toString(CryptoJS.enc.Utf8):s}if($(`#three_way_${localStorage.getItem("theme")}`).addClass("selected"),window.innerHeight/window.innerWidth<1.5){$("#v_screen").addClass("post_switch"),$("#v_screen").height("100%"),$("#v_screen").width(.5625*window.innerHeight),$("#v_screen").attr("src","index.html"+window.location.search),$("body > div").addClass("post_switch"),$("body").addClass("post_switch");return}t=new URLSearchParams(window.location.search).get("key");var t,r=!0,n=0;if(""!==getCookie("pcsl_content_key")&&(localStorage.setItem("pcsl_key",getCookie("pcsl_content_key")),removeCookie("pcsl_content_key")),await getSHA384Hash(localStorage.getItem("pcsl_key"))===key_hash[1]?(n=2,t=localStorage.getItem("pcsl_key")):""!==t&&await getSHA384Hash(t)===key_hash[1]?(n=2,r=!1):await getSHA384Hash(localStorage.getItem("pcsl_key"))===key_hash[0]?(n=1,t=localStorage.getItem("pcsl_key")):""!==t&&await getSHA384Hash(t)===key_hash[0]&&(n=1,r=!1),key_valid=n?1:0,localStorage.getItem("pcsl_version_hash")===version_hash&&r){var i=localStorage.getItem("pcsl_data").split("\n");video=JSON.parse(s(i[0])),entry=JSON.parse(s(i[1])),process_data()}else $("#loading_text").html("Downloading data..."),fetch(`data_${n}.txt`).then(s=>(s.ok||(console.log(`failed to load data_${n}.txt`),$("#loading_text").html("Failed to download data.<br />Please reload to try again.<br /><br />Contact site administrator<br />if this problem persists.")),s.text())).then(t=>{let r=t.split("\n");video=JSON.parse(s(r[0])),entry=JSON.parse(s(r[1])),localStorage.setItem("pcsl_data",t),localStorage.setItem("pcsl_version_hash",version_hash),process_data()});key_valid&&(member_display_order=[7,6,5,3,4,2,1,12,10,9],$(".extra").removeClass("hidden"),$(".memcount_subblock").removeClass("anti_extra"),$(".anti_extra").html(""),$(".anti_extra").addClass("hidden"),$("#home_key").removeClass("hidden"),$("#filter_entry_icon_container").addClass("hidden"),$("#filter_entry_icon_extra").removeClass("hidden"))}),$(function(){$(document).on("click","#nav_menu",function(s){s.preventDefault(),!prevent_menu_popup&&($("#menu_container").toggleClass("hidden"),$("#nav_menu").toggleClass("menu_opened"),$(document.body).toggleClass("no_scroll"))}),$(document).on("click","#nav_to_top",function(s){if(s.preventDefault(),!prevent_menu_popup){var t=$("html,body").scrollTop(),r=t/33,n=setInterval(function s(){t-=r,$("html,body").scrollTop(t),t<=0&&clearInterval(n)},1);"repertoire"===current_page&&rep_display_selected_first&&rep_display()}}),$(document).on("click","#menu_container",function(s){$(s.target).parents(".defog").length||$(s.target).hasClass("defog")||($("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))}),$(document).on("click",".menu2page",function(s){var t=$(s.target).attr("id").replace("menu2page_","");t!==current_page&&(jump2page(t),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))}),$(document).on("click","#menu_setting",function(){$("#popup_container").removeClass("hidden"),$("#settings").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0}),$(document).on("click","#menu_count",function(){if($("#popup_container").removeClass("hidden"),$("#memcount").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0,""===$("#memcount_content").html()){for(var s=[],t=0;t<16;++t)s[t]=[0,0,0];for(var t=0;t<entry.length;++t){if(is_private(t)){s[entry[t][entry_idx.type]][2]++;continue}if(entry[t][entry_idx.note].includes("【メン限")){s[entry[t][entry_idx.type]][1]++;continue}s[entry[t][entry_idx.type]][0]++}var r='<table id="memcount_table"><tr><th></th><th>通常</th><th>メン限</th><th>非公開</th></tr>';for(var t in member_display_order){var n=member_display_order[t];r+='<tr class="memcount_row singer_'+n+'"><td><div class="memcount_name">'+singer_lookup[n]+"</div></td>";for(var i=0;i<3;++i)r+="<td"+(0===s[n][i]?' class="memcount_empty"':"")+">"+s[n][i]+"</td>";r+="</tr>"}var a=[[0,0,0],[0,0,0]];for(var t in entry)for(var i=0;i<3;++i)1<<i&entry[t][entry_idx.type]&&a[entry[t][entry_idx.type]>8?1:0][i]++;if(key_valid){r+='</table><div id="memcount_sum_warpper" class="memcount_sum"><div class="memcount_sum_icon col-1 colspan-2"></div>';for(var o=0;o<2;++o)for(var l=2;l>=0;--l)r+='<div class="row-'+(o+1)+" col-"+(4-l)+" singer_"+((o?8:0)+(1<<l))+'">'+a[o][l]+"</div>"}else{r+='</table><div class="memcount_sum"><div class="memcount_sum_icon"></div>';for(var t=2;t>=0;--t)r+='<div class="singer_'+(1<<t)+'">'+a[0][t]+"</div>"}$("#memcount_content").html(r+"</div>"),memcount_rep_int=setInterval(memcount_load_rep,1)}}),$(document).on("click","#menu_info",function(){$("#popup_container").removeClass("hidden"),$("#information").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0}),$(document).on("click",".three_way>div",function(){var s=$(this).attr("id").replace("three_way_","");document.documentElement.setAttribute("theme",s),localStorage.setItem("theme",s),$(".three_way>div").removeClass("selected"),$(this).addClass("selected")}),$(document).on("click",".two_way:not(.disabled)",function(){switch($(this).children().toggleClass("selected"),this.id){case"setting_hidden":do_display_hidden^=1,localStorage.setItem("pcsl_s_showHidden",do_display_hidden?"1":"0");break;case"setting_select":do_select_input^=1,localStorage.setItem("pcsl_s_selecInput",do_select_input?"1":"0");break;case"setting_random":do_show_random^=1,$("#nav_search_random").toggleClass("blank",do_show_random),localStorage.setItem("pcsl_s_showRandom",do_show_random?"1":"0"),$(".setting_req_random").toggleClass("disabled",!do_show_random);break;case"setting_ignore":do_random_anyway^=1,$("#nav_search_random").toggleClass("disabled",!searching_song_name||!do_random_anyway&&""!==loading),localStorage.setItem("pcsl_s_ignoreRule",do_random_anyway?"1":"0");break;case"setting_release":do_show_release^=1,localStorage.setItem("pcsl_s_showReleas",do_show_release?"1":"0"),"repertoire"===current_page&&rep_display()}}),$(document).on("click","#memcount, #memcount_rep",function(s){$(s.target).closest(".popup_frame").length&&$(".memcount_subblock").toggleClass("hidden")}),$(document).on("click","#popup_container",function(s){$(s.target).closest(".popup_frame").length||$(s.target).find("#rep_list:not(.hidden)").length||($(".popup_frame").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1)}),$(document).on("click","#home_key_reset",function(){$("#popup_container").removeClass("hidden"),$("#remove_key").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).addClass("no_scroll"),prevent_menu_popup=!0}),$(document).on("click","#remove_key_yes",function(){removeCookie("pcsl_content_key"),localStorage.clear(),window.location=window.location.href.split("?")[0]}),$(document).on("click","#remove_key_nah",function(){$("#remove_key").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1})});var today=new Date().setHours(0,0,0,0);function get_date_different(s,t=today){return Math.round(Math.abs((s="string"==typeof s?new Date(s):s)-(t=void 0===t?t:new Date(t)))/864e5)}function get_sang_count(s,t=[4,2,1,12,10,9]){var r=0,n=0;for(var i in entry_proc[s])t.some(t=>(t&entry[entry_proc[s][i]][entry_idx.type])===t)&&(r++,entry[entry_proc[s][i]][entry_idx.note].includes("【メン限")&&n++);return[r,n]}function jump2page(s){switch(current_page=s="rep"===s?"repertoire":s,$(".menu2page_selected").removeClass("menu2page_selected"),$("#menu2page_"+s).addClass("menu2page_selected"),$(".section_container").addClass("hidden"),$("#"+s+"_section").removeClass("hidden"),$("#nav_dummy").addClass("hidden"),$("#nav_search_random").addClass("hidden"),$("#nav_bulk_search").addClass("hidden"),$("#nav_share").addClass("hidden"),$("#search_display").html(""),$("#rep_display").html(""),s){case"home":$("#nav_title").html("ホーム"),$("#nav_dummy").removeClass("hidden");break;case"search":$("#nav_search_random").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!is_searching_from_rep),$("#nav_title").html("曲検索"),$("#input").val(""),search();break;case"rep":case"repertoire":$("#repertoire_section").removeClass("hidden"),$("#nav_bulk_search").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!rep_selected.length),$("#nav_title").html("レパートリー"),rep_input_memory="",rep_search();break;default:return -1}$(window).scrollTop(0)}function split_to_solo(s){switch(s){case 1:case 2:case 4:case 9:case 10:case 12:return[s];case 3:return[1,2];case 5:return[1,4];case 6:return[2,4];case 7:return[1,2,4]}}var copy_popup_is_displaying=!1;function copy_popup(){!copy_popup_is_displaying&&(copy_popup_is_displaying=!0,$("#copy_popup").attr("class","fade_out"),setTimeout(()=>{copy_popup_is_displaying=!1,$("#copy_popup").attr("class","hidden")},1500))}function to_html(s){return s.replaceAll('"',"&quot;").replaceAll("'","&apos;")}function to_non_html(s){return s.replaceAll("&quot;",'"').replaceAll("&apos;","'")}const getSHA384Hash=async s=>{let t=new TextEncoder().encode(s),r=await window.crypto.subtle.digest("SHA-384",t),n=Array.from(new Uint8Array(r)),i=n.map(s=>s.toString(16).padStart(2,"0")).join("");return i};function getCookie(s){let t=s+"=",r=document.cookie.split(";");for(let n=0;n<r.length;n++){let i=r[n];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function removeCookie(s){document.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}var loading="",singer_chosen=[1,1,1],part_filter=[1,1,1,1,1,1],part_rom=[1,2,4,9,10,12],hide_song=[],searching_song_name=!0,search_sort_by_date=!0,search_sort_asd=!0,is_searching_from_rep=!1,search_input_focused=!1;$(function(){$(document).on("click","#nav_search_random",function(){if((!$(this).hasClass("disabled")||do_random_anyway)&&!prevent_menu_popup){var s,t=trial=0,r=7;for(var n in singer_chosen)singer_chosen[n]||(r-=1<<n);if(0!=(r&=hard_filter)){do for(var n in entry_proc[s=Math.floor(Math.random()*song.length)])if(!(7!==r&&!(r&entry[entry_proc[s][n]][entry_idx.type])||!do_display_hidden&&is_private(entry_proc[s][n]))){t++;break}while(0===t);$("#input").val(song[s][song_idx.name]),is_searching_from_rep=0,search()}}}),$(document).on("click","#nav_share",function(){if(!("search"!==current_page||$(this).hasClass("disabled"))){for(var s="szk31.github.io/pcsl/?search="+song_lookup.indexOf(hits[0]),t=1;t<hits.length;++t)s+=","+song_lookup.indexOf(hits[t]);navigator.clipboard.writeText(s),copy_popup()}}),$(document).on("input","#input",function(){auto_search()}),$(document).on("mousedown",".auto_panel",function(){var s=to_non_html($(this).attr("id"));$("#input").val(s)}),$(document).on("blur","#input",function(){$("#search_auto").addClass("hidden"),search_input_focused=!1,is_searching_from_rep?is_searching_from_rep=0:$("#nav_share").toggleClass("disabled",!is_searching_from_rep),search()}),$(document).on("keydown",function(s){13===s.keyCode&&"search"===current_page&&$("#input").blur()}),$(document).on("click","#input",function(){if(!search_input_focused){if(search_input_focused=!0,do_select_input){var s=this;setTimeout(function(){s.setSelectionRange(0,$(s).val().length)},0)}else"!bulk_load_flag"===loading&&($(this).val(""),$("#nav_search_random").removeClass("disabled"),$("#nav_share").addClass("disabled"));auto_search()}}),$(document).on("click","#search_options_button",function(){$("#search_options_button").toggleClass("opened"),$("#search_options_container").toggleClass("hidden")}),$(document).on("click",".singer_icon",function(){var s=parseInt($(this).attr("class").split(/\s+/).find(s=>s.startsWith("sing_sel_")).replace("sing_sel_","")),t=part_rom.indexOf(s);0<=t&&t<=2&&(singer_chosen[t]^=1),part_filter[t]^=1,$(".sing_sel_"+s).toggleClass("selected"),loading="",search()}),$(document).on("click",".search_option_group1",function(){var s="songname"===$(this).attr("id").replace(/(search_options_)/,"");s!==searching_song_name&&(searching_song_name=s,$(".search_option_group1>.radio").toggleClass("selected"),$("#input").val(""),$("#nav_share").addClass("disabled"),$("#input").attr("placeholder",searching_song_name?"曲名/読みで検索":"アーティスト名で検索"),$("#search_display").html(""),loading="",$("#nav_search_random").toggleClass("disabled",!searching_song_name))}),$(document).on("click",".search_option_group2",function(){var s="date"===$(this).attr("id").replace(/(search_options_)/,"");search_sort_by_date!==s&&(search_sort_by_date=s,$(".search_option_group2>.radio").toggleClass("selected"),update_display(),$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"))}),$(document).on("click",".search_option_group3",function(){search_sort_asd^=1,$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"),update_display()}),$(document).on("click",".song_name_container",function(s){if(!$(s.target).hasClass("song_copy_icon")){var t=parseInt($(this).attr("id"));hide_song.includes(t)?hide_song.splice(hide_song.indexOf(t),1):hide_song.push(t),$(".song_"+t).toggleClass("hidden"),$("#fold_"+t).toggleClass("closed")}}),$(document).on("click",".song_copy_icon",function(){var s=parseInt($(this).attr("id").replace("copy_name_",""));navigator.clipboard.writeText(song[s][song_idx.name]),copy_popup()}),$(document).on("click",".entry_share",function(){var s=parseInt($(this).attr("id").replace("entry_",""));let t="https://www.youtube.com/watch?v="+video[entry[s][entry_idx.video]][video_idx.id];fetch("https://noembed.com/embed?dataType=json&url="+t).then(s=>s.json()).then(function(t){if(void 0===t.title){alert("動画タイトル取得できませんでした。");return}var r="";r=0===entry[s][entry_idx.time]?t.title+"\n(youtu.be/"+video[entry[s][entry_idx.video]][video_idx.id]+")":song[entry[s][entry_idx.song_id]][song_idx.name].trim()+" / "+song[entry[s][entry_idx.song_id]][song_idx.artist]+" @"+t.title+"\n(youtu.be/"+video[entry[s][entry_idx.video]][video_idx.id]+timestamp(s)+")",do_share_web&&(r+="\n\nszk31.github.io/pcsl/?search="+song_lookup.indexOf(entry[s][entry_idx.song_id])+"より"),window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(r),"_blank")})})});var hits=[];function auto_search(){var s,t,r,n=$("#input").val().normalize("NFKC").toLowerCase().trim();if(""===n||!searching_song_name){$("#search_auto").addClass("hidden");return}var i=[],a=[],o=0,l=0;for(var d in series_lookup)for(var c in series_lookup[d]){var p=series_lookup[d][c].indexOf(n);if(-1!==p){i[o++]=d;break}}if(/[^\u3040-\u309F\u30FC\u30F4]/.test(n)){for(var d=1;d<song.length;++d)if(!(d>2)||song[d][song_idx.name].trim()!==song[d-1][song_idx.name].trim()){var p=song[d][song_idx.name].toLowerCase().indexOf(n);if(-1===p){var h=song[d][song_idx.reading].indexOf(" ");h>0&&song[d][song_idx.reading].indexOf(n)>h&&(p=1)}switch(p){case 0:entry_proc[d].length>0&&(i[o++]=d);break;case -1:break;default:entry_proc[d].length>0&&(a[l++]=d)}if(o>=auto_display_max)break}}else for(var d=1;d<song.length;++d)if(!(d>2)||song[d][song_idx.name].trim()!==song[d-1][song_idx.name].trim()){var p=song[d][song_idx.reading].indexOf(n);switch(p){case 0:entry_proc[d].length>0&&(i[o++]=d);break;case -1:break;default:entry_proc[d].length>0&&(a[l++]=d)}if(o>=auto_display_max)break}var g=0,u="";for(var d in i){if(isNaN(parseInt(i[d])))s="",t=r=i[d];else{var m=song[i[d]][song_idx.reading];s=-1===m.indexOf(" ")?bold(m,n):bold(m.substring(0,m.indexOf(" ")),n),t=bold(r=song[i[d]][song_idx.name],n)}u+='<div id="'+to_html(r)+'" class="auto_panel'+(0===g?" auto_first":"")+'"><div class="auto_reading">'+s+'</div><div class="auto_display">'+t+"</div></div>",g++}for(var d in a)if(u+='<div id="'+to_html(song[a[d]][song_idx.name])+'" class="auto_panel'+(0===g?" auto_first":"")+'"><div class="auto_reading"></div><div class="auto_display">'+bold(song[a[d]][song_idx.name],n)+"</div></div>",++g>=auto_display_max)break;$("#search_auto").html(u),""!==u?$("#search_auto").removeClass("hidden"):$("#search_auto").addClass("hidden")}function search(){if(is_searching_from_rep){update_display();return}var s=$("#input").val().trim();if(s!==loading){if(loading=s,""===s){$("#search_display").html(""),$("#nav_search_random").removeClass("disabled");return}do_random_anyway||$("#nav_search_random").addClass("disabled"),s=s.normalize("NFKC").toLowerCase();var t="";for(var r in series_lookup){for(var n in series_lookup[r])if(series_lookup[r].includes(s)){t=r;break}if(""!==t)break}var i=0;if(""!=t){var a=[2,3,4,7];for(var r in a)if(attr_idx[a[r]]===t){i=a[r];break}}hits=[];for(var r=1;r<song.length&&200!==hits.length;++r)if(searching_song_name){if(""!==t){if(song[r][song_idx.reading].includes(t)){hits.push(r);continue}i&&1<<i&song[r][song_idx.attr]&&hits.push(r)}else(processed_song_name[r].includes(s)||song[r][song_idx.reading].toLowerCase().includes(s))&&hits.push(r)}else song[r][song_idx.artist].toLowerCase().includes(s)&&hits.push(r);$("#nav_share").toggleClass("disabled",searching_song_name||0===hits),hits.sort(function(t,r){return song[t][song_idx.name].trim().toLowerCase()===s?song[r][song_idx.name].trim().toLowerCase()===s?0:-1:song[r][song_idx.name].trim().toLowerCase()===s?1:void 0}),update_display()}}function update_display(s=!1){if(s|=is_searching_from_rep,$("#search_auto").addClass("hidden"),""!==loading||s){var t=-1,r=7;for(var n in singer_chosen)singer_chosen[n]||(r-=1<<n);r&=hard_filter;for(var i=[],a=0,o="",l=0,d=0,n=0;n<hits.length;++n){var c=[];d+=(c=search_sort_by_date?entry_proc[hits[n]].sort((s,t)=>search_sort_asd?s-t:t-s):entry_proc[hits[n]].sort((s,t)=>entry[s][entry_idx.type]===entry[t][entry_idx.type]?s-t:(search_sort_asd?1:-1)*(display_order[entry[s][entry_idx.type]]-display_order[entry[t][entry_idx.type]]))).length;for(var p=0;p<c.length;++p){var h=c[p],g=!0;for(var u in part_filter)if(part_filter[u]&&((8|part_rom[u])&entry[h][entry_idx.type])===part_rom[u]){g=!1;break}if(!(g||!do_display_hidden&&is_private(h))){if(t!==entry[h][entry_idx.song_id]){o+=(-1!==t?"</div>":"")+'<div class="song_container">',t=entry[h][entry_idx.song_id],i[a++]=t;for(var m=!hide_song.includes(t),v=song[t][song_idx.name].normalize("NFKC"),f=0,u=0;u<v.length;++u)f+=/[ -~]/.test(v.charAt(u))?1:2;"secret base ~君がくれたもの~"===v&&(f=0),"みくみくにしてあげる♪【してやんよ】"===v&&(v="みくみくにしてあげる♪<br />【してやんよ】"),/([^~]+~+[^~])/g.test(v)&&f>=28&&(v=v.substring(0,v.search(/~/g))+"<br />"+v.substring(v.search(/~/g))),o+='<div class="song_name_container '+(a%2?"odd_colour":"even_colour")+'" id="'+t+'"><div class="song_rap"><div class="song_name">'+v+'</div><div class="song_credit'+(m?"":" hidden")+(song[t][song_idx.artist].length>30?" long_credit":"")+" song_"+t+'">'+song[t][song_idx.artist]+'</div></div><div class="song_icon_container"><div id="fold_'+t+'" class="song_fold_icon'+(m?"":" closed")+'"></div><div id="copy_name_'+t+'" class="song_copy_icon song_'+t+(m?"":" hidden")+'"></div></div></div>'}var y=entry[h][entry_idx.note].includes("【メン限"),_=""===entry[h][entry_idx.note]||"【メン限】"===entry[h][entry_idx.note]||"【メン限アーカイブ】"===entry[h][entry_idx.note],b=entry[h][entry_idx.note];if(y&&(b=b.includes("メン限アーカイブ")?b.replace(/【メン限アーカイブ】/g,""):b.replace(/【メン限】/g,"")),o+='<div class="entry_container singer_'+entry[h][entry_idx.type]+(y?"m":"")+" song_"+t+(hide_song.includes(t)?" hidden":"")+'"><a href="https://youtu.be/'+video[entry[h][entry_idx.video]][video_idx.id]+timestamp(h)+'" target="_blank"><div class="entry_primary"><div class="entry_date">'+display_date(video[entry[h][entry_idx.video]][video_idx.date])+'</div><div class="entry_singer">'+singer_lookup[entry[h][entry_idx.type]]+'</div><div class="mem_display">'+(y?"メン限":"")+'</div><div class="entry_share" id="entry_'+h+'" onclick="return false;"></div></div>'+(_?"":'<div class="entry_note">'+b+"</div>")+"</a></div>",++l>=400){n=200;break}}}}do{if(""!==o)break;if(0===hits.length){o+='<div class="search_no_result">曲検索結果なし';break}if(d>0){o+='<div class="search_no_result">非表示動画のみ';break}o+='<div class="search_no_result">歌記録なし'}while(0);$("#search_display").html(o+'</div><div class="general_vertical_space"></div>');for(var n=0;n<hide_song.length;++n)i.includes(hide_song[n])||hide_song.splice(n--,1)}}function timestamp(s){return 0===entry[s][entry_idx.time]?"":"?t="+entry[s][entry_idx.time]}function max_count_update(s){var t=s.selectionStart,r=s.selectionEnd,n=$(s).val();n=n.replace(/[^\d]/g,"").substring(0,3),$("#search_options_count_input").val(n),s.setSelectionRange(t,r)}var attr_idx=["others","アニソン","ラブライブ","アイマス","マクロス","J-POP","ボカロ","ジブリ","特撮","ロック","歌謡曲","ポップス","R&B","キャラソン","disney"],rep_list=[],rep_singer=[1,1,1,1,1,1],rep_anisong={lovelive:[1,2],imas:[1,3],macros:[1,4],other:[1,1]},rep_genre={jpop:[1,5],voc:[1,6],jib:[1,7],tok:[1,8],rock:[1,9],kay:[1,10],pops:[1,11],rnb:[1,12],cha:[1,13],dis:[1,14],other:[1,0]},oke_gone=["ノーザンクロス"],rep_sort="50",rep_sort_asd=!0,rep_display_selected_first=!1,rep_edit_selected=-1,selected_member=[4,2,1,12,10,9];const selected_member_ram=[4,2,1,12,10,9],exist=s=>selected_member.includes(s);var is_long_pressing=!1;$(function(){$(document).on("blur","#rep_input",function(){rep_search()}),$(document).on("keydown",function(s){13===s.keyCode&&"repertoire"===current_page&&$("#rep_input").blur()}),$(document).on("click",".filter_title",function(){var s=$(this).attr("id").replace(/(filter_)|(_title)/g,"");$("#filter_"+s+"_close").toggleClass("closed"),$("#filter_"+s+"_content").toggleClass("hidden")}),$(document).on("click",".filter_icon",function(){var s=$(this).attr("class").split(/\s+/).find(s=>s.startsWith("icon_")).replace("icon_",""),t=-1;switch(s){case"kirara":t=0;break;case"momo":t=1;break;case"nia":t=2;break;default:return}rep_singer[t]^=1,$(this).toggleClass("selected"),rep_search(!0)}),$(document).on("click",".filter_icon_extra",function(){var s=$(this).attr("class").split(/\s+/).find(s=>s.startsWith("icon_")).replace("icon_",""),t=-1;switch(s){case"kirara":t=0;break;case"momo":t=1;break;case"nia":t=2;break;case"chui":t=3;break;case"shiro":t=4;break;case"yuco":t=5;break;default:return}rep_singer[t]^=1,$(this).toggleClass("selected"),rep_search(!0)}),$(document).on("click",".filter_entry_attr_item",function(){var s=$(this).attr("id").replace(/(attr_container_)/,"");if("all"===s)for(var t in $(".attr_checkbox").toggleClass("selected",!$("#attr_"+s).hasClass("selected")),rep_attr)rep_attr[t]=$("#attr_"+s).hasClass("selected")?1:0;else if($("#attr_"+s).toggleClass("selected"),rep_attr[s]^=1,$("#attr_"+s).hasClass("selected")){for(var t in rep_attr)if(!rep_attr[t]){rep_search();return}$("#attr_all").addClass("selected")}else $("#attr_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_genre_anisong_item",function(){var s=$(this).attr("id").replace(/(genre_container_anisong_)/,"");if("all"===s)for(var t in $(".genre_anisong_checkbox").toggleClass("selected",!$("#anisong_all").hasClass("selected")),rep_anisong)rep_anisong[t][0]=$("#anisong_all").hasClass("selected")?1:0;else if($("#anisong_"+s).toggleClass("selected"),rep_anisong[s][0]^=1,$("#anisong_"+s).hasClass("selected")){for(var t in rep_anisong)if(!rep_anisong[t][0]){rep_search();return}$("#anisong_all").addClass("selected")}else $("#anisong_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_genre_general_item",function(){var s=$(this).attr("id").replace(/(genre_container_general_)/,"");if("all"===s)for(var t in $(".genre_general_checkbox").toggleClass("selected",!$("#general_all").hasClass("selected")),rep_genre)rep_genre[t][0]=$("#general_all").hasClass("selected")?1:0;else if($("#general_"+s).toggleClass("selected"),rep_genre[s][0]^=1,$("#general_"+s).hasClass("selected")){for(var t in rep_genre)if(!rep_genre[t][0]){rep_search();return}$("#general_all").addClass("selected")}else $("#general_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_sort_item",function(){var s=$(this).attr("id").replace(/(sort_container_)/,"");rep_sort!==s&&($(".sort_checkbox").removeClass("selected"),$("#sort_"+s).addClass("selected"),rep_sort=s,update_rep_sort_display(),rep_display())}),$(document).on("click",".filter_sort2_item",function(){rep_sort_asd^=1,update_rep_sort_display(),rep_display()}),$(document).on("click",".filter_sort3_item",function(){rep_display_selected_first^=1,$(".sort3_checkbox").toggleClass("selected",rep_display_selected_first),rep_display()}),$(document).on("click",".rep_song_container",function(){if(!is_long_pressing){var s=parseInt($(this).attr("id").replace(/(rep_song_)/,""));$(this).hasClass("selected")?(rep_selected.splice(rep_selected.indexOf(s),1),0===rep_selected.length&&($("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))):(rep_selected.push(s),$("#nav_share").removeClass("disabled"),$("#nav_bulk_search").removeClass("disabled")),$(this).toggleClass("selected")}}),$(document).on("mousedown touchstart",".rep_song_container",function(){var s=parseInt($(this).attr("id").replace(/(rep_song_)/,""));longpress_timer=setTimeout(function(){navigator.clipboard.writeText(song[s][song_idx.name]),copy_popup(),is_long_pressing=!0,post_longpress_timer=setTimeout(function(){is_long_pressing=!1,clearTimeout(post_longpress_timer)},500)},600)}),$(document).on("mouseup mouseleft touchend touchmove",".rep_song_container",function(){clearTimeout(longpress_timer)}),$(document).on("click","#nav_bulk_search",function(){is_searching_from_rep=1,jump2page("search"),hits=copy_of(rep_selected),loading="!bulk_load_flag",$("#input").val(""),update_display(1)}),$(document).on("click","#nav_share",function(){!("repertoire"!==current_page||$(this).hasClass("disabled")||prevent_menu_popup)&&(prevent_menu_popup=!0,$(document.body).toggleClass("no_scroll"),$("#rep_list").removeClass("hidden"),$("#popup_container").removeClass("hidden"),rep_update_list())}),$(document).on("click","#rep_list_artist",function(){!$("#rep_list_artist").hasClass("disabled")&&($("#list_artist_cb").toggleClass("selected"),rep_update_list())}),$(document).on("click","#rep_list_edit",function(){0!==rep_selected.length&&(-1===rep_edit_selected?($("#rep_list_edit").html("編集終了"),$("#rep_list_artist").addClass("disabled"),$("#rep_list_close").addClass("disabled"),$("#rep_compose_tweet").addClass("disabled"),$("#rep_list_leftbar").removeClass("hidden"),$("#rep_list_container").addClass("editing"),rep_edit_selected=-2,rep_update_leftbar()):($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1))}),$(document).on("click",".rep_list_item",function(){var s=parseInt($(this).attr("id").replace(/(rep_btn_)/,""));switch(rep_edit_selected){case -1:case -2:rep_edit_selected=s,rep_update_leftbar();break;case s:rep_edit_selected=-2,rep_update_leftbar();break;default:if($(this).hasClass("arrow_up")){[rep_selected[s],rep_selected[s+1]]=[rep_selected[s+1],rep_selected[s]],rep_edit_selected--,rep_update_list(),rep_update_leftbar();var t=Math.max(0,rep_edit_selected-1),r=$("#rep_list_leftbar").offset().top,n=$("#rep_btn_"+t).offset().top;n<r&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-r+n),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}if($(this).hasClass("arrow_down")){[rep_selected[s-1],rep_selected[s]]=[rep_selected[s],rep_selected[s-1]],rep_edit_selected++,rep_update_list(),rep_update_leftbar();var t=Math.min(rep_edit_selected+1,rep_selected.length-1),i=$("#rep_list_leftbar").offset().top+$("#rep_list_leftbar").height(),a=$("#rep_btn_"+t).offset().top+$("#rep_btn_"+t).height();a>i&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-i+a),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}}}),$(document).on("click",".rep_list_delete",function(){rep_edit_selected>=0&&($("#rep_song_"+rep_selected[rep_edit_selected]).removeClass("selected"),rep_selected.splice(rep_edit_selected,1)),rep_edit_selected=-2,rep_update_list(),rep_update_leftbar(),0===rep_selected.length&&($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1,$("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))}),$("#rep_list_content").on("scroll",function(){$("#rep_list_leftbar").scrollTop($("#rep_list_content").scrollTop())}),$(document).on("click","#rep_list_close",function(){!$("#rep_list_close").hasClass("disabled")&&(prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll"))}),$(document).on("click","#rep_compose_tweet",function(){if(!$("#rep_compose_tweet").hasClass("disabled")&&0!==rep_selected.length){prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll");var s="";for(var t in rep_selected)s+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(s),"_blank")}}),$(document).on("click","#rep_copy",function(){var s="";for(var t in rep_selected)s+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";navigator.clipboard.writeText(s),copy_popup()})});var rep_hits=[],rep_hits_solo=[],rep_hits_count=0,rep_selected=[],rep_input_memory="";function rep_search(s=!1){var t=$("#rep_input").val().normalize("NFKC").trim();if(t!==rep_input_memory)rep_input_memory=t;else if(!s&&""!==t)return;for(var r in selected_member=[],selected_member_ram)rep_singer[r]&&selected_member.push(selected_member_ram[r]);if(""!==rep_input_memory){rep_hits=[],rep_hits_count=0;for(var r=1;r<song.length;++r)0!==entry_proc[r].length&&(-1!==processed_song_name[r].search(t.toLowerCase())||-1!==song[r][song_idx.reading].search(t))&&(rep_hits[rep_hits_count++]=r);rep_display();return}if(0===selected_member.length){$("#rep_display").html("");return}var n=0;for(var r in rep_hits=[],rep_hits_count=0,rep_anisong)n+=rep_anisong[r][0]<<rep_anisong[r][1];for(var r in rep_genre)n+=rep_genre[r][0]<<rep_genre[r][1];var i=0;for(var r in rep_anisong)"other"!==r&&(i+=1-rep_anisong[r][0]<<rep_anisong[r][1]);for(var r=0;r<song.length;++r)if(song[r][song_idx.attr]&n){if(0!=i&&song[r][song_idx.attr]&i||!rep_hits_solo[r].some(exist))continue;rep_hits[rep_hits_count++]=r}rep_display()}function rep_display(){if(rep_display_selected_first)for(var s in rep_selected)-1!==rep_hits.indexOf(rep_selected[s])&&rep_hits.splice(rep_hits.indexOf(rep_selected[s]),1);switch($("#rep_display").html(""),rep_sort){case"50":rep_hits.sort((s,t)=>s-t),rep_sort_asd||rep_hits.reverse();break;case"count":var t=[];for(var s in song){if(6===selected_member.length){t[s]=entry_proc[s].length;continue}for(var r in t[s]=0,entry_proc[s])selected_member.includes(entry[entry_proc[s][r]][entry_idx.type])&&t[s]++}rep_hits.sort((s,r)=>(rep_sort_asd?1:-1)*(t[r]-t[s]));break;case"date":var n=[];for(var s in song){var i=get_last_sang(s,selected_member);n[s]=i?i.getTime():0}rep_hits.sort((s,t)=>(rep_sort_asd?1:-1)*(n[t]-n[s]));break;case"release":for(var n=[],s=1;s<song.length;++s)n[s]=to8601(song[s][song_idx.release]).getTime();rep_hits.sort((s,t)=>(rep_sort_asd?1:-1)*(n[t]-n[s]));break;default:console.log('rep_sort of type "'+rep_sort+'" not found');return}rep_display_selected_first&&(rep_hits=rep_selected.concat(rep_hits)),rep_loading_progress=0,rep_display_loop(),clearInterval(rep_display_inter),rep_display_inter=setInterval(rep_display_loop,10)}var rep_loading_progress=0;function rep_display_loop(){for(var s=Math.min(rep_loading_progress+20,rep_hits.length),t=rep_loading_progress;t<s;++t){var r=get_sang_count(rep_hits[t],selected_member),n='<div class="rep_song_container'+(rep_selected.includes(rep_hits[t])?" selected":"")+(r[0]>0&&r[0]===r[1]?" rep_mem_only":"")+'" id="rep_song_'+rep_hits[t]+'"><div class="rep_song_row1">';n+='<div class="rep_song_title">'+song[rep_hits[t]][song_idx.name]+" / "+song[rep_hits[t]][song_idx.artist]+"</div>",n+='<div class="rep_song_nooke">'+(oke_gone.includes(song[rep_hits[t]][song_idx.name])?"オケ消滅":"")+"</div>",n+='</div><div class="rep_song_info grid_block-4">';var i=get_last_sang(rep_hits[t],selected_member),a=0===i?-1:get_date_different(i);n+="<div>"+(0===a?"今日":-1===a?"---":a+"日前")+"</div>",n+="<div>"+r[0]+"回"+(r[1]>0?r[0]===r[1]?" (メン限のみ)":" ("+r[1]+"回メン限)":"")+"</div>",n+='<div class="rep_song_singer'+(key_valid?" rep_singer_2rows":"")+'"><div class="'+(rep_hits_solo[rep_hits[t]].includes(4)?"rep_song_kirara":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(2)?"rep_song_momo":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(1)?"rep_song_nia":"rep_song_empty")+'"></div>'+(key_valid?'<div class="'+(rep_hits_solo[rep_hits[t]].includes(12)?"rep_song_chui":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(10)?"rep_song_shiro":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(9)?"rep_song_yuco":"rep_song_empty")+'"></div>':"")+"</div>",do_show_release?n+='<div class="rep_extra_info"> ('+display_date(to8601(song[rep_hits[t]][song_idx.release]))+")</div>":n+="<div></div>",$("#rep_display").append(n+"</div></div>")}(rep_loading_progress+=20)>=rep_hits.length&&(clearInterval(rep_display_inter),$("#rep_display").append('<div class="general_vertical_space"></div>'))}function rep_update_list(){for(var s="",t=0;t<rep_selected.length;++t)s+='<div id="rep_btn_'+t+'" class="rep_list_item"></div>';$("#rep_list_leftbar").html(s),s="";for(var r=$("#list_artist_cb").hasClass("selected"),n=0,t=0;t<rep_selected.length;++t){var i=song[rep_selected[t]][song_idx.name]+(r?" / "+song[rep_selected[t]][song_idx.artist]:"");for(var a in s+='<div id="list_'+t+'">'+i+"</div>",i)n+=/[ -~]/.test(i[a])?1:2;n++}$("#rep_list_content").html(s),$(".rep_list_wordcount").html("長さ<br />"+n+"/280"),$(".rep_list_wordcount").toggleClass("red_text",n>280)}function rep_update_leftbar(){$(".rep_list_item").attr("class","rep_list_item"),$(".rep_list_delete").addClass("hidden"),rep_edit_selected>=0&&($(".rep_list_item").addClass("blank"),rep_edit_selected>0&&$("#rep_btn_"+(rep_edit_selected-1)).attr("class","rep_list_item arrow_up"),$("#rep_btn_"+rep_edit_selected).attr("class","rep_list_item"),rep_edit_selected<rep_hits.length-1&&$("#rep_btn_"+(rep_edit_selected+1)).attr("class","rep_list_item arrow_down"),$(".rep_list_delete").removeClass("hidden"))}function update_rep_sort_display(){var s="";switch(rep_sort){case"50":s=rep_sort_asd?"正順 (⇌逆順)":"逆順 (⇌正順)";break;case"count":s=rep_sort_asd?"多い順 (⇌少ない順)":"少ない順 (⇌多い順)";break;case"date":case"release":s=rep_sort_asd?"新しい順 (⇌古い順)":"古い順 (⇌新しい順)";break;default:return 1}$("#sort_name_sort").html(s)}